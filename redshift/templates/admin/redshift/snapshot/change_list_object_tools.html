{% extends "admin/change_list_object_tools.html" %}

{% block object-tools-items %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <li><label for="id_start_date">开始日期: </label><input type="text" id="id_start_date" value="{{ start_date }}"/></li>
    <li><label for="id_end_date">结束日期: </label><input type="text" id="id_end_date" value="{{ end_date }}"/></li>
    <li><a id="id_refresh_snapshots" href="{% url 'redshift:refresh_snapshots' %}{% if start_date %}?start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}">刷新列表</a></li>
    <script>
        const btn_refresh_snapshots = $('#id_refresh_snapshots');
        const input_start_date = $('#id_start_date');
        const input_end_date = $('#id_end_date');

        function build_refresh_snapshots_url() {
            const baseUrl = new URL(btn_refresh_snapshots.prop('href'));
            const params = {
                start_date: input_start_date.val(),
                end_date: input_end_date.val()
            };

            const urlParams = Object.keys(params).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`).join('&');
            return `${baseUrl.pathname}?${urlParams}`;
        }

        $(function () {
            input_start_date.datepicker();
            input_end_date.datepicker();
            input_start_date.change(function () {
                btn_refresh_snapshots.prop('href', build_refresh_snapshots_url());
            });
            input_end_date.change(function () {
                btn_refresh_snapshots.prop('href', build_refresh_snapshots_url());
            });
        });
    </script>
    {{ block.super }}
{% endblock %}
